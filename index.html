<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Juego de Tarjetas üî•</title>
  <style>
    :root{
      --bg: #0f1220;
      --card: #171a2b;
      --muted: #8b90a6;
      --text: #eef1ff;
      --accent: linear-gradient(135deg,#6a5cff, #00d4ff);
      --ok:#00d68f; --warn:#ffd34e; --danger:#ff5b6a; --brown:#8b5a2b;
      --ring: 0 0 0 3px rgba(106,92,255,.35);
      --radius: 18px;
    }
    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial;
      color:var(--text); background: radial-gradient(1200px 800px at 80% -20%,rgba(0,212,255,.15),transparent), var(--bg);
      display:flex; align-items:center; justify-content:center; padding:24px;
    }
    .app{ width:min(960px,100%); }
    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.04), transparent), var(--card);
      border:1px solid rgba(255,255,255,.08);
      border-radius: var(--radius);
      box-shadow: 0 10px 40px rgba(0,0,0,.35);
      padding: clamp(20px, 3vw, 32px);
    }
    h1{
      margin:0 0 6px; font-size: clamp(24px, 4vw, 36px); letter-spacing:.4px;
      background:var(--accent); -webkit-background-clip:text; background-clip:text; color:transparent;
    }
    .sub{ color:var(--muted); margin-bottom:22px; }
    .grid{ display:grid; gap:14px; grid-template-columns: 1fr; }
    @media (min-width:720px){ .grid-2{ grid-template-columns: 1fr 1fr; } }

    .input, select{
      width:100%; padding:12px 14px; border-radius:12px; border:1px solid rgba(255,255,255,.15);
      background:rgba(255,255,255,.03); color:var(--text); outline:none;
    }
    .input:focus, select:focus{ box-shadow: var(--ring); border-color: transparent; }

    .row{ display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
    .spacer{ flex:1; }

    .btn{
      appearance:none; border:none; cursor:pointer; color:#0b0e1a; font-weight:700;
      padding:12px 18px; border-radius:14px; transition:.2s transform, .2s filter, .2s opacity;
      background:var(--accent); box-shadow: 0 8px 24px rgba(0,212,255,.25);
    }
    .btn:hover{ transform: translateY(-1px); }
    .btn:active{ transform: translateY(0); filter: brightness(.95); }
    .btn:disabled{ opacity:.5; cursor:not-allowed; transform:none; }
    .btn-outline{
      background: transparent; color:var(--text); border:1px solid rgba(255,255,255,.2);
      box-shadow:none;
    }
    .btn-yellow{ background: linear-gradient(135deg, #ffd34e, #ffb800); color:#2a1f00; }
    .btn-red{ background: linear-gradient(135deg, #ff6a7a, #ff3347); color:#2a0000; }
    .btn-brown{ background: linear-gradient(135deg, #c28b52, #8b5a2b); color:#140a02; }
    .btn-ghost{ background:transparent; color:var(--muted); box-shadow:none; }

    .pill{
      display:inline-flex; gap:8px; align-items:center; padding:8px 12px; border-radius:999px;
      background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.09); color:var(--text);
    }
    .list{
      display:flex; flex-wrap:wrap; gap:10px; margin-top:10px;
    }
    .chip{
      display:inline-flex; align-items:center; gap:8px; padding:8px 12px; border-radius:999px;
      background:rgba(255,255,255,.05); border:1px solid rgba(255,255,255,.12);
    }
    .chip .x{ cursor:pointer; opacity:.7; }
    .divider{ height:1px; background:linear-gradient(90deg, transparent, rgba(255,255,255,.12), transparent); margin:16px 0; }
    .center{ text-align:center; }

    .stack{ display:grid; gap:18px; }
    .stack-lg{ display:grid; gap:24px; }

    .players{
      display:flex; flex-wrap:wrap; gap:12px;
    }
    .player{
      display:flex; align-items:center; gap:10px; padding:10px 12px; border-radius:14px;
      border:1px solid rgba(255,255,255,.12); background:rgba(255,255,255,.04);
    }

    .screen{ display:none; }
    .screen.active{ display:block; }

    .gallery{
      display:grid; place-items:center; gap:14px;
    }
    .card-img{
      width:min(720px, 100%);
      border-radius:16px; border:1px solid rgba(255,255,255,.15);
      background:rgba(255,255,255,.04); overflow:hidden;
      box-shadow: 0 14px 50px rgba(0,0,0,.45);
    }
    .card-img img{ width:100%; display:block; }

    /* ‚ÄúJugar‚Äù extra llamativo */
    .btn-jugar{
      position:relative; isolation:isolate;
      background: conic-gradient(from 0deg at 50% 50%, #6a5cff, #00d4ff, #6a5cff);
      color:white;
    }
    .btn-jugar::before{
      content:""; position:absolute; inset:-3px; z-index:-1; border-radius:16px;
      background: radial-gradient(400px 80px at 50% -20%, rgba(255,255,255,.35), transparent), var(--accent);
      filter: blur(12px); opacity:.85;
    }

    /* Peque√±as ayudas de accesibilidad */
    .sr{ position:absolute; left:-9999px; }
  </style>
</head>
<body>
  <div class="app">
    <!-- PANTALLA 1: Registro -->
    <section id="screen-setup" class="screen active">
      <div class="card stack-lg">
        <header>
          <h1>Retos en pareja üî•</h1>
          <div class="sub">A√±ade personas con su g√©nero y cuando est√©s listo, ¬°pulsa <strong>Jugar</strong>!</div>
        </header>

        <div class="grid grid-2">
          <div class="stack">
            <label>Nombre
              <input id="inp-nombre" class="input" type="text" placeholder="Ej: Ana" autocomplete="off" />
            </label>
          </div>
          <div class="stack">
            <label>G√©nero
              <select id="sel-genero">
                <option value="Hombre">Hombre ‚ôÇ</option>
                <option value="Mujer">Mujer ‚ôÄ</option>
              </select>
            </label>
          </div>
        </div>

        <div class="row">
          <button id="btn-add" class="btn" type="button">A√±adir persona</button>
          <span class="spacer"></span>
          <span class="pill" title="Total actuales"><svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10Zm1-6.5v-2.75H9.75a.75.75 0 1 1 0-1.5H13V8.5a.75.75 0 0 1 1.5 0v2.75h2.75a.75.75 0 0 1 0 1.5H14.5V15.5a.75.75 0 0 1-1.5 0Z"/></svg>
            <strong id="count">0</strong> personas
          </span>
        </div>

        <div id="lista" class="list" aria-live="polite"></div>

        <div class="divider"></div>

        <div class="row">
          <button id="btn-reset" class="btn btn-outline" type="button">Limpiar lista</button>
          <span class="spacer"></span>
          <button id="btn-jugar" class="btn btn-jugar" type="button" disabled>üéÆ Jugar</button>
        </div>
      </div>
    </section>

    <!-- PANTALLA 2: Selecci√≥n de tarjetas -->
    <section id="screen-game" class="screen">
      <div class="card stack-lg">
        <header class="row">
          <div>
            <h1>Jugadores</h1>
            <div class="sub">Verifica la lista y elige una tarjeta.</div>
          </div>
          <span class="spacer"></span>
          <button id="btn-volver-setup" class="btn btn-ghost" type="button">‚¨ÖÔ∏è Editar personas</button>
        </header>

        <div id="players" class="players" aria-live="polite"></div>

        <div class="divider"></div>

        <div class="row" style="gap:12px; justify-content:center;">
          <button id="btn-amarilla" class="btn btn-yellow" type="button">üòè Retos Suaves</button>
          <button id="btn-roja" class="btn btn-red" type="button">ü•µ Retos Calientes</button>
          <button id="btn-marron" class="btn btn-brown" type="button">üòàüî• Retos Super Calientes</button>
        </div>
      </div>
    </section>

    <!-- PANTALLA 3: Mostrar imagen -->
    <section id="screen-card" class="screen">
      <div class="card stack-lg">
        <header class="center">
          <h1 id="titulo-tipo">Tarjeta</h1>
          <div class="sub" id="sub-tipo"></div>
        </header>

        <div class="gallery">
          <div class="card-img">
            <img id="card-image" alt="Imagen aleatoria de la tarjeta seleccionada" />
          </div>
          <div class="row center" style="justify-content:center; gap:12px;">
            <button id="btn-reveal-another" class="btn btn-outline" type="button">üîÅ Otra aleatoria</button>
            <button id="btn-back-to-choices" class="btn" type="button">‚Ü©Ô∏è Volver a jugar</button>
          </div>
          <div class="center" id="error-box" style="color:#ffb3bb; display:none;"></div>
        </div>
      </div>
    </section>
  </div>

  <svg class="sr" aria-hidden="true">
    <!-- √çconos de G√©nero (definiciones para uso en l√≠nea si se quiere con <use>) -->
    <symbol id="ico-male" viewBox="0 0 24 24">
      <path fill="currentColor" d="M14 3h7v7h-2V6.414l-4.243 4.243a6.5 6.5 0 1 1-1.414-1.414L17.586 5H14V3ZM6.5 14A4.5 4.5 0 1 0 11 18.5 4.505 4.505 0 0 0 6.5 14Z"/>
    </symbol>
    <symbol id="ico-female" viewBox="0 0 24 24">
      <path fill="currentColor" d="M12 2a6 6 0 0 1 2 11.65V16h2a1 1 0 1 1 0 2h-2v2a1 1 0 1 1-2 0v-2h-2a1 1 0 1 1 0-2h2v-2.35A6 6 0 0 1 12 2Zm0 2a4 4 0 1 0 4 4 4.005 4.005 0 0 0-4-4Z"/>
    </symbol>
  </svg>

  <script>
    /****************************************************************
     * CONFIGURACI√ìN DE CARPETAS / ARCHIVOS
     * --------------------------------------------------------------
     * Para que las im√°genes aleatorias funcionen sin servidor, usa
     * nombres consecutivos: 1.jpg, 2.jpg, 3.jpg, ...
     * Ajusta `count` y `ext` seg√∫n tu carpeta.
     ****************************************************************/
    const CARD_SETS = {
      amarilla: { label: "Tarjeta Amarilla", dir: "recursos/Tarjetas Amarillas", count: 20, ext: "png" },
      roja:     { label: "Tarjeta Roja",     dir: "recursos/Tarjetas Rojas",     count: 20, ext: "png" },
      marron:   { label: "Tarjeta Marr√≥n",   dir: "recursos/Tarjetas Marrones",  count: 12, ext: "png" },
    };

    /****************************************************************
     * ESTADO
     ****************************************************************/
    const state = {
      people: loadPeople(),
      lastChoice: null, // 'amarilla' | 'roja' | 'marron'
    };

    /****************************************************************
     * HELPERS
     ****************************************************************/
    function $(sel){ return document.querySelector(sel); }
    function el(tag, props={}, ...children){
      const n = document.createElement(tag);
      Object.assign(n, props);
      for(const c of children){ n.append(c); }
      return n;
    }
    function savePeople(){ localStorage.setItem("web-tarjetas.people", JSON.stringify(state.people)); }
    function loadPeople(){
      try{
        const raw = localStorage.getItem("web-tarjetas.people");
        return raw ? JSON.parse(raw) : [];
      }catch{ return []; }
    }
    function iconForGender(g){
      const isMale = (g || "").toLowerCase() === "hombre";
      const sym = isMale ? "#ico-male" : "#ico-female";
      return `<svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><use href="${sym}"></use></svg>`;
    }

    function toastError(msg){
      const box = $("#error-box");
      if(!box) return;
      box.textContent = msg; box.style.display = "block";
      setTimeout(()=>{ box.style.display="none"; }, 3500);
    }

    /****************************************************************
     * RENDER: PANTALLA 1 (Setup)
     ****************************************************************/
    const inpNombre = $("#inp-nombre");
    const selGenero = $("#sel-genero");
    const btnAdd = $("#btn-add");
    const btnReset = $("#btn-reset");
    const btnJugar = $("#btn-jugar");
    const lista = $("#lista");
    const count = $("#count");

    function renderSetup(){
      // contador y estado del bot√≥n Jugar
      count.textContent = state.people.length;
      btnJugar.disabled = state.people.length === 0;

      // lista de chips
      lista.innerHTML = "";
      state.people.forEach((p, idx)=>{
        const chip = el("div", { className:"chip" });
        const icon = el("span"); icon.innerHTML = iconForGender(p.genero);
        const name = el("span", { textContent: p.nombre });
        const x = el("span", { className:"x", title:"Quitar", innerHTML:"&times;" });
        x.addEventListener("click", ()=>{
          state.people.splice(idx,1);
          savePeople();
          renderSetup();
        });
        chip.append(icon, name, x);
        lista.append(chip);
      });
    }

    btnAdd.addEventListener("click", ()=>{
      const nombre = (inpNombre.value || "").trim();
      const genero = selGenero.value;
      if(!nombre){ inpNombre.focus(); return; }

      state.people.push({ nombre, genero });
      savePeople();
      inpNombre.value = "";
      renderSetup();
      inpNombre.focus();
    });

    btnReset.addEventListener("click", ()=>{
      state.people = [];
      savePeople();
      renderSetup();
      inpNombre.focus();
    });

    btnJugar.addEventListener("click", ()=>{
      goTo("screen-game");
      renderGame();
    });

    /****************************************************************
     * RENDER: PANTALLA 2 (Game choices)
     ****************************************************************/
    const playersDiv = $("#players");
    const btnVolverSetup = $("#btn-volver-setup");
    const btnAmarilla = $("#btn-amarilla");
    const btnRoja = $("#btn-roja");
    const btnMarron = $("#btn-marron");

    function renderGame(){
      playersDiv.innerHTML = "";
      if(state.people.length === 0){
        playersDiv.append(el("div",{ textContent:"No hay jugadores. Vuelve atr√°s y a√±ade al menos uno." }));
      }else{
        state.people.forEach(p=>{
          const item = el("div", { className:"player" });
          const ico = el("span"); ico.innerHTML = iconForGender(p.genero);
          const nm = el("strong", { textContent: p.nombre });
          const gen = el("span", { className:"sub", style:"margin-left:6px; font-size:12px;", textContent: `(${p.genero})` });
          item.append(ico, nm, gen);
          playersDiv.append(item);
        });
      }
    }

    btnVolverSetup.addEventListener("click", ()=>{
      goTo("screen-setup");
      renderSetup();
    });

    btnAmarilla.addEventListener("click", ()=> showRandomCard("amarilla"));
    btnRoja.addEventListener("click",     ()=> showRandomCard("roja"));
    btnMarron.addEventListener("click",   ()=> showRandomCard("marron"));

    /****************************************************************
     * PANTALLA 3: Mostrar imagen aleatoria
     ****************************************************************/
    const tituloTipo = $("#titulo-tipo");
    const subTipo = $("#sub-tipo");
    const cardImg = $("#card-image");
    const btnBackToChoices = $("#btn-back-to-choices");
    const btnRevealAnother = $("#btn-reveal-another");

    btnBackToChoices.addEventListener("click", ()=>{
      goTo("screen-game");
    });

    btnRevealAnother.addEventListener("click", ()=>{
      if(!state.lastChoice) return;
      revealRandomImage(state.lastChoice, true);
    });

    function showRandomCard(kind){
      state.lastChoice = kind;
      // Setear t√≠tulos
      const cfg = CARD_SETS[kind];
      tituloTipo.textContent = cfg.label;
      subTipo.textContent = `Mostrando imagen aleatoria de ‚Äú${cfg.dir}/‚Äù`;
      // Ir a la pantalla y revelar
      goTo("screen-card");
      revealRandomImage(kind, false);
    }

    function revealRandomImage(kind, silent){
      const cfg = CARD_SETS[kind];
      if(!cfg || !cfg.count){
        toastError("Configuraci√≥n inv√°lida para esta tarjeta.");
        return;
      }
      const idx = 1 + Math.floor(Math.random() * cfg.count);
      const url = `${cfg.dir}/${idx}.${cfg.ext}`;
      // Intentar mostrar imagen; si falla, notificar
      cardImg.src = "";
      const testImg = new Image();
      testImg.onload = ()=>{
        cardImg.src = url;
      };
      testImg.onerror = ()=>{
        toastError(`No se pudo cargar ${url}. Verifica nombre/ubicaci√≥n/permiso de la imagen.`);
        if(!silent){
          // intenta otra al primer fallo no-silencioso
          setTimeout(()=> revealRandomImage(kind, true), 50);
        }
      };
      testImg.src = url;
    }

    /****************************************************************
     * NAVEGACI√ìN ENTRE "PANTALLAS" (SPA)
     ****************************************************************/
    function goTo(id){
      document.querySelectorAll(".screen").forEach(s=> s.classList.remove("active"));
      document.getElementById(id).classList.add("active");
      window.scrollTo({ top:0, behavior:"smooth" });
    }

    /****************************************************************
     * INICIO
     ****************************************************************/
    renderSetup();
  </script>
</body>
</html>